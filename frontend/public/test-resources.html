<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>资源加载测试</title>
  <link rel="icon" href="/favicon.ico">
</head>
<body>
  <h1>资源加载测试页面</h1>
  <div id="test-results"></div>
  <script>
    // 测试资源加载
    const results = document.getElementById('test-results');
    let successCount = 0;
    let errorCount = 0;
    
    function logResult(message, isSuccess) {
      const div = document.createElement('div');
      div.style.padding = '5px';
      div.style.margin = '5px';
      div.style.backgroundColor = isSuccess ? '#d4edda' : '#f8d7da';
      div.textContent = message;
      results.appendChild(div);
      
      if (isSuccess) successCount++;
      else errorCount++;
    }
    
    // 测试favicon加载
    const favicon = new Image();
    favicon.onload = () => logResult('✓ favicon.ico 加载成功', true);
    favicon.onerror = () => logResult('✗ favicon.ico 加载失败', false);
    favicon.src = '/favicon.ico?timestamp=' + Date.now();
    
    // 测试manifest.json加载
    fetch('/manifest.json?timestamp=' + Date.now())
      .then(response => {
        if (response.ok) {
          logResult('✓ manifest.json 加载成功', true);
          return response.json();
        } else {
          throw new Error('加载失败');
        }
      })
      .catch(error => logResult('✗ manifest.json 加载失败: ' + error.message, false));
      
    // 测试API代理
    fetch('/api/test-proxy?timestamp=' + Date.now())
      .then(response => {
        if (response.status === 404) {
          // 如果后端没有这个端点，404也是可以接受的，说明代理配置正确
          logResult('✓ API代理配置正确 (收到404响应，说明请求已发送到后端)', true);
        } else if (response.ok) {
          logResult('✓ API代理配置正确且后端响应成功', true);
        } else {
          logResult('⚠ API代理配置正确但后端返回错误状态码: ' + response.status, false);
        }
      })
      .catch(error => logResult('✗ API代理配置错误: ' + error.message, false));
      
    // 显示测试统计
    setTimeout(() => {
      const summary = document.createElement('div');
      summary.style.marginTop = '20px';
      summary.style.padding = '10px';
      summary.style.border = '2px solid #ccc';
      summary.textContent = '测试结果: 成功 ' + successCount + ', 失败 ' + errorCount;
      results.appendChild(summary);
    }, 3000);
  </script>
</body>
</html>